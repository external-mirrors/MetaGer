build_dependencies_npm:
  stage: build_dependencies
  image: node:14
  script:
    - cd metager
    - npm install --cache .npm --prefer-offline --no-audit
    - npm run prod
  artifacts:
    paths:
      - metager/public
    expire_in: 2 hrs
  cache:
    paths:
      - metager/.npm/

build_dependencies_composer:
  stage: build_dependencies
  image: ${CI_REGISTRY_IMAGE}/$DOCKER_COMPOSER_IMAGE_NAME:$DOCKER_COMPOSER_IMAGE_TAG
  before_script:
    - export COMPOSER_HOME=$(pwd)/metager/.composer
  script:
    - cd metager
    - echo $COMPOSER_HOME
    - composer install --optimize-autoloader --no-dev
  artifacts:
    paths:
      - metager/vendor
    expire_in: 2 hrs
  cache:
    paths:
      - metager/.composer/

  